From 07c2ce597b5f6d6f619d5cdb8d2ea4a4cb7849b3 Mon Sep 17 00:00:00 2001
From: papacu <papacu@papacu.com>
Date: Thu, 15 May 2025 07:22:08 -0300
Subject: [PATCH] sdcard fix

---
 packages/SystemUI/src/com/android/systemui/flags/Flags.kt   | 4 ++--
 .../core/java/com/android/server/StorageManagerService.java | 6 ++++--
 2 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/packages/SystemUI/src/com/android/systemui/flags/Flags.kt b/packages/SystemUI/src/com/android/systemui/flags/Flags.kt
index fe9c9cb4f7c8..8ddfa60edb2a 100644
--- a/packages/SystemUI/src/com/android/systemui/flags/Flags.kt
+++ b/packages/SystemUI/src/com/android/systemui/flags/Flags.kt
@@ -172,7 +172,7 @@ object Flags {
     /** Enables new QS Edit Mode visual refresh */
     // TODO(b/269787742): Tracking Bug
     @JvmField
-    val ENABLE_NEW_QS_EDIT_MODE = unreleasedFlag("enable_new_qs_edit_mode", teamfood = false)
+    val ENABLE_NEW_QS_EDIT_MODE = releasedFlag("enable_new_qs_edit_mode")
 
     // 600- status bar
 
@@ -328,7 +328,7 @@ object Flags {
 
     // TODO(b/277201412): Tracking Bug
     @JvmField
-    val SPLIT_SHADE_SUBPIXEL_OPTIMIZATION = unreleasedFlag("split_shade_subpixel_optimization")
+    val SPLIT_SHADE_SUBPIXEL_OPTIMIZATION = releasedFlag("split_shade_subpixel_optimization")
 
     // TODO(b/278761837): Tracking Bug
     @JvmField val USE_NEW_ACTIVITY_STARTER = releasedFlag(name = "use_new_activity_starter")
diff --git a/services/core/java/com/android/server/StorageManagerService.java b/services/core/java/com/android/server/StorageManagerService.java
index d580bb2e023f..ecffeb17ec87 100644
--- a/services/core/java/com/android/server/StorageManagerService.java
+++ b/services/core/java/com/android/server/StorageManagerService.java
@@ -1635,8 +1635,10 @@ class StorageManagerService extends IStorageManager.Stub
 
             // Adoptable public disks are visible to apps, since they meet
             // public API requirement of being in a stable location.
-            // Assume all SDs match this as well
-            if (vol.disk.isAdoptable() || vol.disk.isSd()) {
+            if (vol.disk.isAdoptable()) {
+                vol.mountFlags |= VolumeInfo.MOUNT_FLAG_VISIBLE_FOR_WRITE;
+            } else if (vol.disk.isSd()) {
+                vol.mountFlags |= VolumeInfo.MOUNT_FLAG_VISIBLE_FOR_WRITE;
             }
 
             vol.mountUserId = mCurrentUserId;
-- 
2.49.0

